# Generated by Anaconda 34.25.5.9
# Generated by pykickstart v3.32
#version=OL9
graphical
cdrom

repo --name="AppStream" --baseurl=file:///run/install/sources/mount-0000-cdrom/AppStream

%addon com_redhat_kdump --enable --reserve-mb='auto'
%end

keyboard --xlayouts='us'
lang en_US.UTF-8
rootpw --iscrypted --allow-ssh DUMMYDATA


# Networking
# For VMware: keep static config
#network  --bootproto=dhcp --noipv6 --activate --device=linked --onboot=on
#network  --hostname=cgb-rocky9

# For AWS: comment out above, use:
 network --bootproto=dhcp --device=ens5 --activate --hostname=rocky9-master



%packages
@^server-product-environment
openssh-server
chrony
%end

firstboot --enable

ignoredisk --only-use=sda
bootloader --append="crashkernel=1G-64G:448M,64G-:512M" --location=mbr --boot-drive=sda
clearpart --none --initlabel


# Disk partitioning
part /boot --fstype="xfs" --ondisk=sda --size=2048
part pv.344 --fstype="lvmpv" --ondisk=sda --size=64000
volgroup vg_root --pesize=4096 pv.344

logvol /              --fstype="xfs" --size=10240  --name=root          --vgname=vg_root
logvol /home          --fstype="xfs" --size=5120   --name=home          --vgname=vg_root
logvol /opt           --fstype="xfs" --size=10240  --name=opt           --vgname=vg_root
logvol /tmp           --fstype="xfs" --size=2048   --name=tmp           --vgname=vg_root
logvol /var           --fstype="xfs" --size=10240  --name=var           --vgname=vg_root
logvol /var/tmp       --fstype="xfs" --size=2048   --name=var_tmp       --vgname=vg_root
logvol /var/log       --fstype="xfs" --size=5120   --name=var_log       --vgname=vg_root
logvol /var/log/audit --fstype="xfs" --size=2048   --name=var_log_audit --vgname=vg_root
logvol swap           --fstype="swap" --size=16384 --name=swap          --vgname=vg_root

timezone America/New_York --utc

# Post-install CIS hardening
%post --log=/root/ks-post.log
# Mount options for CIS
sed -i '/\/tmp/s/defaults/defaults,nodev,nosuid,noexec/' /etc/fstab
echo "/tmp /var/tmp none bind 0 0" >> /etc/fstab
sed -i '/\/home/s/defaults/defaults,nodev/' /etc/fstab
sed -i '/\/var\/log /s/defaults/defaults,nodev/' /etc/fstab
sed -i '/\/var\/log\/audit/s/defaults/defaults,nodev/' /etc/fstab

# Enable services
systemctl enable auditd
systemctl enable sshd
systemctl start sshd
%end
reboot --eject